#include "xparameters.h"
#include "xiicps.h"
#include "xil_printf.h"
#include <stdio.h>
#include "sleep.h"
#include "xgpio.h"
#include "bsp/camera.h"
#include "xsdps.h"
#include "ff.h"
#include "xil_cache.h"
#include "bsp/iic.h"

u8 camera_read[2*640*480*2] __attribute__ ((aligned(32))) = {0};


int main()
{
	int status;

	status = init_gpio();
	if (status != XST_SUCCESS) {
		printf("GPIO initialization failed.\n");
		return 0;
	}
	usleep(10000);

	status = init_i2c();
	if (status != XST_SUCCESS) {
		printf("I2C initialization failed.\n");
		return 0;
	}
	usleep(10000);

	sleep(1);
	status = init_sd(1);
	if (status != XST_SUCCESS) {
		printf("SD card initialization failed.\n");
		return 0;
	}
	usleep(10000);

	status = init_camera();
	if (status != XST_SUCCESS) {
		printf("Camera card initialization failed.\n");
		return 0;
	}
	usleep(10000);

	if(take_photo() != XST_SUCCESS){
		printf("Failed to take image.\n");
	}

	printf("Complete\n\r");

	XGpio_DiscreteSet(&led_btns, 2, 0x00);

	return 0;
}

